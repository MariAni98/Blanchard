"use strict";function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){for(var e=["DocumentType","Element","CharacterData"],t=function(){null!=this.parentNode&&this.parentNode.removeChild(this)},i=0;i<e.length;i++){var r=e[i];window[r]&&!window[r].prototype.remove&&(window[r].prototype.remove=t)}}(),function(e){function t(){}function i(e,t){return function(){e.apply(t,arguments)}}function r(e){if("object"!==_typeof(this))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],u(e,this)}function n(e,t){for(;3===e._state;)e=e._value;return 0===e._state?void e._deferreds.push(t):(e._handled=!0,void r._immediateFn(function(){var i=1===e._state?t.onFulfilled:t.onRejected;if(null===i)return void(1===e._state?o:s)(t.promise,e._value);var r;try{r=i(e._value)}catch(n){return void s(t.promise,n)}o(t.promise,r)}))}function o(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"===("undefined"==typeof t?"undefined":_typeof(t))||"function"==typeof t)){var n=t.then;if(t instanceof r)return e._state=3,e._value=t,void a(e);if("function"==typeof n)return void u(i(n,t),e)}e._state=1,e._value=t,a(e)}catch(o){s(e,o)}}function s(e,t){e._state=2,e._value=t,a(e)}function a(e){2===e._state&&0===e._deferreds.length&&r._immediateFn(function(){e._handled||r._unhandledRejectionFn(e._value)});for(var t=0,i=e._deferreds.length;t<i;t++)n(e,e._deferreds[t]);e._deferreds=null}function l(e,t,i){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=i}function u(e,t){var i=!1;try{e(function(e){i||(i=!0,o(t,e))},function(e){i||(i=!0,s(t,e))})}catch(r){if(i)return;i=!0,s(t,r)}}var d=setTimeout;r.prototype["catch"]=function(e){return this.then(null,e)},r.prototype.then=function(e,i){var r=new this.constructor(t);return n(this,new l(e,i,r)),r},r.all=function(e){var t=Array.prototype.slice.call(e);return new r(function(e,i){function r(o,s){try{if(s&&("object"===("undefined"==typeof s?"undefined":_typeof(s))||"function"==typeof s)){var a=s.then;if("function"==typeof a)return void a.call(s,function(e){r(o,e)},i)}t[o]=s,0===--n&&e(t)}catch(l){i(l)}}if(0===t.length)return e([]);for(var n=t.length,o=0;o<t.length;o++)r(o,t[o])})},r.resolve=function(e){return e&&"object"===("undefined"==typeof e?"undefined":_typeof(e))&&e.constructor===r?e:new r(function(t){t(e)})},r.reject=function(e){return new r(function(t,i){i(e)})},r.race=function(e){return new r(function(t,i){for(var r=0,n=e.length;r<n;r++)e[r].then(t,i)})},r._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){d(e,0)},r._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},r._setImmediateFn=function(e){r._immediateFn=e},r._setUnhandledRejectionFn=function(e){r._unhandledRejectionFn=e},"undefined"!=typeof module&&module.exports?module.exports=r:e.Promise||(e.Promise=r)}(window),function(e){e.Promise||(e.Promise=Promise);var t="required",i="email",r="minLength",n="maxLength",o="password",s="zip",a="phone",l="remote",u="strength",d="function",c=function(e,t){if("string"==typeof e)return e;var i="post"===t.toLowerCase()?"":"?";return Array.isArray(e)?i+e.map(function(e){return e.name+"="+e.value}).join("&"):i+Object.keys(e).map(function(t){return t+"="+e[t]}).join("&")},h=function(e){var t=e.url,i=e.method,r=e.data,n=e.debug,o=e.callback,s=e.error;if(n)return void o("test");var a=e.async!==!1,l=new XMLHttpRequest,u=c(r,"get"),d=null;"post"===i.toLowerCase()&&(d=c(r,"post"),u=""),l.open(i,t+u,a),l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),l.onreadystatechange=function(){4===this.readyState&&(200===this.status?o(this.responseText):s&&s(this.responseText))},l.send(d)},f=function(e,t){this.options=t||{},this.rules=this.options.rules||{},this.messages=this.options.messages||void 0,this.colorWrong=this.options.colorWrong||"#B81111",this.result={},this.elements=[],this.tooltip=this.options.tooltip||{},this.tooltipFadeOutTime=this.tooltip.fadeOutTime||5e3,this.tooltipFadeOutClass=this.tooltip.fadeOutClass||"just-validate-tooltip-hide",this.tooltipSelectorWrap=document.querySelectorAll(this.tooltip.selectorWrap).length?document.querySelectorAll(this.tooltip.selectorWrap):document.querySelectorAll(".just-validate-tooltip-container"),this.bindHandlerKeyup=this.handlerKeyup.bind(this),this.submitHandler=this.options.submitHandler||void 0,this.invalidFormCallback=this.options.invalidFormCallback||void 0,this.promisesRemote=[],this.isValidationSuccess=!1,this.focusWrongField=this.options.focusWrongField||!1,this.REGEXP={email:/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,zip:/^\d{5}(-\d{4})?$/,phone:/^([0-9]( |-)?)?(\(?[0-9]{3}\)?|[0-9]{3})( |-)?([0-9]{3}( |-)?[0-9]{4}|[a-zA-Z0-9]{7})$/,password:/[^\w\d]*(([0-9]+.*[A-Za-z]+.*)|[A-Za-z]+.*([0-9]+.*))/,strengthPass:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]/},this.DEFAULT_REMOTE_ERROR="Error",this.state={tooltipsTimer:null},this.setForm(document.querySelector(e))};f.prototype={defaultRules:{email:{required:!0,email:!0},name:{required:!0,minLength:3,maxLength:15},text:{required:!0,maxLength:300,minLength:5},password:{required:!0,password:!0,minLength:4,maxLength:8},zip:{required:!0,zip:!0},phone:{phone:!0}},defaultMessages:{required:"The field is required",email:"Please, type a valid email",maxLength:"The field must contain a maximum of :value characters",minLength:"The field must contain a minimum of :value characters",password:"Password is not valid",remote:"Email already exists",strength:"Password must contents at least one uppercase letter, one lowercase letter and one number","function":"Function returned false"},handlerKeyup:function(e){var t=e.target,i={name:t.getAttribute("data-validate-field"),value:t.value};delete this.result[i.name],this.validateItem({name:i.name,value:i.value,group:[],isKeyupChange:!0}),this.renderErrors()},setterEventListener:function(e,t,i,r){switch("keyup"===t&&(i=this.bindHandlerKeyup),r){case"add":e.addEventListener(t,i);break;case"remove":e.removeEventListener(t,i)}},getElementsRealValue:function(){for(var e=this.$form.querySelectorAll("*"),t=void 0,i={},r=0,n=e.length;r<n;++r)if(t=e[r].getAttribute("name")){if("checkbox"===e[r].type){i[t]=e[r].checked;continue}i[t]=e[r].value}return i},validationFailed:function(){this.invalidFormCallback&&this.invalidFormCallback(this.result);var e=document.querySelector(".js-validate-error-field");this.focusWrongField&&e&&e.focus&&e.focus()},validationSuccess:function(){if(0===Object.keys(this.result).length){if(this.isValidationSuccess=!1,this.submitHandler){var e=this.getElementsRealValue();return void this.submitHandler(this.$form,e,h)}this.$form.submit()}},setForm:function(e){var t=this;this.$form=e,this.$form.setAttribute("novalidate","novalidate"),this.$form.addEventListener("submit",function(e){return e.preventDefault(),t.result=[],t.getElements(),t.promisesRemote.length?void Promise.all(t.promisesRemote).then(function(){t.promisesRemote=[],t.isValidationSuccess?t.validationSuccess():t.validationFailed()}):void(t.isValidationSuccess?t.validationSuccess():t.validationFailed())})},isEmail:function(e){return this.REGEXP.email.test(e)},isZip:function(e){return this.REGEXP.zip.test(e)},isPhone:function(e){return this.REGEXP.phone.test(e)},isPassword:function(e){return this.REGEXP.password.test(e)},isEmpty:function(e){var t=e;return e.trim&&(t=e.trim()),!t},checkLengthMax:function(e,t){return e.length<=t},checkLengthMin:function(e,t){return e.length>=t},checkStrengthPass:function(e){return this.REGEXP.strengthPass.test(e)},getElements:function(){var e=this,t=this.$form.querySelectorAll("[data-validate-field]");this.elements=[];for(var i=function(i,r){var n=t[i],o=n.getAttribute("data-validate-field"),s=n.value,a=!1,l=[];if("checkbox"===n.type&&(s=n.checked||"",n.addEventListener("change",function(t){var i=t.target,r={name:i.getAttribute("data-validate-field"),value:i.checked};delete e.result[r.name],e.validateItem({name:r.name,value:r.value,group:[]}),e.renderErrors()})),"radio"===n.type){var u=e.elements.filter(function(e){if(e.name===o)return e})[0];u?(u.group.push(n.checked),a=!0):l.push(n.checked),n.addEventListener("change",function(t){var i=t.target,r={name:i.getAttribute("data-validate-field"),value:i.checked};delete e.result[r.name],e.validateItem({name:r.name,value:r.value,group:[]}),e.renderErrors()})}e.setterEventListener(n,"keyup",e.handlerKeyup,"add"),a||e.elements.push({name:o,value:s,group:l})},r=0,n=t.length;r<n;++r)i(r,n);this.validateElements()},validateRequired:function(e){return!this.isEmpty(e)},validateEmail:function(e){return this.isEmail(e)},validatePhone:function(e){return this.isPhone(e)},validateMinLength:function(e,t){return this.checkLengthMin(e,t)},validateMaxLength:function(e,t){return this.checkLengthMax(e,t)},validateStrengthPass:function(e){return this.checkStrengthPass(e)},validatePassword:function(e){return this.isPassword(e)},validateZip:function(e){return this.isZip(e)},validateRemote:function(e){var t=e.value,i=e.name,r=e.url,n=e.successAnswer,o=e.sendParam,s=e.method;return new Promise(function(e){h({url:r,method:s,data:_defineProperty({},o,t),async:!0,callback:function(t){t.toLowerCase()===n.toLowerCase()&&e("ok"),e({type:"incorrect",name:i})},error:function(){e({type:"error",name:i})}})})},generateMessage:function(e,t,i){var r=this.messages||this.defaultMessages,n=r[t]&&r[t][e]||this.messages&&"string"==typeof this.messages[t]&&r[t]||this.defaultMessages[e]||this.DEFAULT_REMOTE_ERROR;i&&(n=n.replace(":value",i.toString())),this.result[t]={message:n}},validateElements:function(){var e=this;return this.lockForm(),this.elements.forEach(function(t){e.validateItem({name:t.name,value:t.value,group:t.group})}),this.promisesRemote.length?void Promise.all(this.promisesRemote).then(function(t){t.forEach(function(t){return"ok"===t?void e.renderErrors():("error"===t.type&&alert("Server error occured. Please try later."),e.generateMessage(l,t.name),void e.renderErrors())})}):void this.renderErrors()},validateItem:function(e){var c=this,h=e.name,f=e.group,m=e.value,v=e.isKeyupChange,p=this.rules[h]||this.defaultRules[h]||!1;if(p)for(var g in p){var y=p[g];if(g!==t&&g!==d&&""==m)return;switch(g){case d:if("function"!=typeof y)break;if(y(h,m))break;return void this.generateMessage(d,h,y);case t:if(!y)break;if(f.length){var b=!1;if(f.forEach(function(e){c.validateRequired(e)&&(b=!0)}),b)break}else if(this.validateRequired(m))break;return void this.generateMessage(t,h);case i:if(!y)break;if(this.validateEmail(m))break;return void this.generateMessage(i,h);case r:if(!y)break;if(this.validateMinLength(m,y))break;return void this.generateMessage(r,h,y);case n:if(!y)break;if(this.validateMaxLength(m,y))break;return void this.generateMessage(n,h,y);case a:if(!y)break;if(this.validatePhone(m))break;return void this.generateMessage(a,h);case o:if(!y)break;if(this.validatePassword(m))break;return void this.generateMessage(o,h);case u:if(!y||"object"!==("undefined"==typeof y?"undefined":_typeof(y)))break;if(y["default"]&&this.validateStrengthPass(m))break;if(y.custom){var E=void 0;try{E=new RegExp(y.custom)}catch(w){E=this.REGEXP.strengthPass,console.error("Custom regexp for strength rule is not valid. Default regexp was used.")}if(E.test(m))break}return void this.generateMessage(u,h);case s:if(!y)break;if(this.validateZip(m))break;return void this.generateMessage(s,h);case l:if(v)break;if(!y)break;var k=y.url,_=y.successAnswer,P=y.method,R=y.sendParam,S=this.$form.querySelector('input[data-validate-field="'+h+'"]');return this.setterEventListener(S,"keyup",this.handlerKeyup,"remove"),void this.promisesRemote.push(this.validateRemote({name:h,value:m,url:k,method:P,sendParam:R,successAnswer:_}))}}},clearErrors:function(){for(var e=document.querySelectorAll(".js-validate-error-label"),t=0,i=e.length;t<i;++t)e[t].remove();e=document.querySelectorAll(".js-validate-error-field");for(var r=0,n=e.length;r<n;++r)e[r].classList.remove("js-validate-error-field"),e[r].style.border="",e[r].style.color=""},renderErrors:function(){var e=this;if(this.clearErrors(),this.unlockForm(),this.isValidationSuccess=!1,0===Object.keys(this.result).length)return void(this.isValidationSuccess=!0);for(var t in this.result){var i=this.result[t].message,r=this.$form.querySelectorAll('[data-validate-field="'+t+'"]'),n=r[r.length-1],o=document.createElement("div");if(o.innerHTML=i,o.className="js-validate-error-label",o.setAttribute("style","color: "+this.colorWrong),n.style.border="1px solid "+this.colorWrong,n.style.color=""+this.colorWrong,n.classList.add("js-validate-error-field"),"checkbox"===n.type||"radio"===n.type){var s=document.querySelector('label[for="'+n.getAttribute("id")+'"]');"label"===n.parentNode.tagName.toLowerCase()?n.parentNode.parentNode.insertBefore(o,null):s?s.parentNode.insertBefore(o,s.nextSibling):n.parentNode.insertBefore(o,n.nextSibling)}else n.parentNode.insertBefore(o,n.nextSibling)}this.tooltipSelectorWrap.length&&(this.state.tooltipsTimer=setTimeout(function(){e.hideTooltips()},this.tooltipFadeOutTime))},hideTooltips:function(){var e=this,t=document.querySelectorAll(".js-validate-error-label");t.forEach(function(t){t.classList.add(e.tooltipFadeOutClass)}),this.state.tooltipsTimer=null},lockForm:function(){for(var e=this.$form.querySelectorAll("input, textarea, button, select"),t=0,i=e.length;t<i;++t)e[t].setAttribute("disabled","disabled"),e[t].style.pointerEvents="none",e[t].style.webitFilter="grayscale(100%)",e[t].style.filter="grayscale(100%)"},unlockForm:function(){for(var e=this.$form.querySelectorAll("input, textarea, button, select"),t=0,i=e.length;t<i;++t)e[t].removeAttribute("disabled"),e[t].style.pointerEvents="",e[t].style.webitFilter="",e[t].style.filter=""}},e.JustValidate=f}(window);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIiwic291cmNlcyI6WyJqdXN0LXZhbGlkYXRlLm1pbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkoZSx0LGkpe3JldHVybiB0IGluIGU/T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsdCx7dmFsdWU6aSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMCx3cml0YWJsZTohMH0pOmVbdF09aSxlfXZhciBfdHlwZW9mPVwiZnVuY3Rpb25cIj09dHlwZW9mIFN5bWJvbCYmXCJzeW1ib2xcIj09dHlwZW9mIFN5bWJvbC5pdGVyYXRvcj9mdW5jdGlvbihlKXtyZXR1cm4gdHlwZW9mIGV9OmZ1bmN0aW9uKGUpe3JldHVybiBlJiZcImZ1bmN0aW9uXCI9PXR5cGVvZiBTeW1ib2wmJmUuY29uc3RydWN0b3I9PT1TeW1ib2wmJmUhPT1TeW1ib2wucHJvdG90eXBlP1wic3ltYm9sXCI6dHlwZW9mIGV9OyFmdW5jdGlvbigpe2Zvcih2YXIgZT1bXCJEb2N1bWVudFR5cGVcIixcIkVsZW1lbnRcIixcIkNoYXJhY3RlckRhdGFcIl0sdD1mdW5jdGlvbigpe251bGwhPXRoaXMucGFyZW50Tm9kZSYmdGhpcy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMpfSxpPTA7aTxlLmxlbmd0aDtpKyspe3ZhciByPWVbaV07d2luZG93W3JdJiYhd2luZG93W3JdLnByb3RvdHlwZS5yZW1vdmUmJih3aW5kb3dbcl0ucHJvdG90eXBlLnJlbW92ZT10KX19KCksZnVuY3Rpb24oZSl7ZnVuY3Rpb24gdCgpe31mdW5jdGlvbiBpKGUsdCl7cmV0dXJuIGZ1bmN0aW9uKCl7ZS5hcHBseSh0LGFyZ3VtZW50cyl9fWZ1bmN0aW9uIHIoZSl7aWYoXCJvYmplY3RcIiE9PV90eXBlb2YodGhpcykpdGhyb3cgbmV3IFR5cGVFcnJvcihcIlByb21pc2VzIG11c3QgYmUgY29uc3RydWN0ZWQgdmlhIG5ld1wiKTtpZihcImZ1bmN0aW9uXCIhPXR5cGVvZiBlKXRocm93IG5ldyBUeXBlRXJyb3IoXCJub3QgYSBmdW5jdGlvblwiKTt0aGlzLl9zdGF0ZT0wLHRoaXMuX2hhbmRsZWQ9ITEsdGhpcy5fdmFsdWU9dm9pZCAwLHRoaXMuX2RlZmVycmVkcz1bXSx1KGUsdGhpcyl9ZnVuY3Rpb24gbihlLHQpe2Zvcig7Mz09PWUuX3N0YXRlOyllPWUuX3ZhbHVlO3JldHVybiAwPT09ZS5fc3RhdGU/dm9pZCBlLl9kZWZlcnJlZHMucHVzaCh0KTooZS5faGFuZGxlZD0hMCx2b2lkIHIuX2ltbWVkaWF0ZUZuKGZ1bmN0aW9uKCl7dmFyIGk9MT09PWUuX3N0YXRlP3Qub25GdWxmaWxsZWQ6dC5vblJlamVjdGVkO2lmKG51bGw9PT1pKXJldHVybiB2b2lkKDE9PT1lLl9zdGF0ZT9vOnMpKHQucHJvbWlzZSxlLl92YWx1ZSk7dmFyIHI7dHJ5e3I9aShlLl92YWx1ZSl9Y2F0Y2gobil7cmV0dXJuIHZvaWQgcyh0LnByb21pc2Usbil9byh0LnByb21pc2Uscil9KSl9ZnVuY3Rpb24gbyhlLHQpe3RyeXtpZih0PT09ZSl0aHJvdyBuZXcgVHlwZUVycm9yKFwiQSBwcm9taXNlIGNhbm5vdCBiZSByZXNvbHZlZCB3aXRoIGl0c2VsZi5cIik7aWYodCYmKFwib2JqZWN0XCI9PT0oXCJ1bmRlZmluZWRcIj09dHlwZW9mIHQ/XCJ1bmRlZmluZWRcIjpfdHlwZW9mKHQpKXx8XCJmdW5jdGlvblwiPT10eXBlb2YgdCkpe3ZhciBuPXQudGhlbjtpZih0IGluc3RhbmNlb2YgcilyZXR1cm4gZS5fc3RhdGU9MyxlLl92YWx1ZT10LHZvaWQgYShlKTtpZihcImZ1bmN0aW9uXCI9PXR5cGVvZiBuKXJldHVybiB2b2lkIHUoaShuLHQpLGUpfWUuX3N0YXRlPTEsZS5fdmFsdWU9dCxhKGUpfWNhdGNoKG8pe3MoZSxvKX19ZnVuY3Rpb24gcyhlLHQpe2UuX3N0YXRlPTIsZS5fdmFsdWU9dCxhKGUpfWZ1bmN0aW9uIGEoZSl7Mj09PWUuX3N0YXRlJiYwPT09ZS5fZGVmZXJyZWRzLmxlbmd0aCYmci5faW1tZWRpYXRlRm4oZnVuY3Rpb24oKXtlLl9oYW5kbGVkfHxyLl91bmhhbmRsZWRSZWplY3Rpb25GbihlLl92YWx1ZSl9KTtmb3IodmFyIHQ9MCxpPWUuX2RlZmVycmVkcy5sZW5ndGg7dDxpO3QrKyluKGUsZS5fZGVmZXJyZWRzW3RdKTtlLl9kZWZlcnJlZHM9bnVsbH1mdW5jdGlvbiBsKGUsdCxpKXt0aGlzLm9uRnVsZmlsbGVkPVwiZnVuY3Rpb25cIj09dHlwZW9mIGU/ZTpudWxsLHRoaXMub25SZWplY3RlZD1cImZ1bmN0aW9uXCI9PXR5cGVvZiB0P3Q6bnVsbCx0aGlzLnByb21pc2U9aX1mdW5jdGlvbiB1KGUsdCl7dmFyIGk9ITE7dHJ5e2UoZnVuY3Rpb24oZSl7aXx8KGk9ITAsbyh0LGUpKX0sZnVuY3Rpb24oZSl7aXx8KGk9ITAscyh0LGUpKX0pfWNhdGNoKHIpe2lmKGkpcmV0dXJuO2k9ITAscyh0LHIpfX12YXIgZD1zZXRUaW1lb3V0O3IucHJvdG90eXBlW1wiY2F0Y2hcIl09ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMudGhlbihudWxsLGUpfSxyLnByb3RvdHlwZS50aGVuPWZ1bmN0aW9uKGUsaSl7dmFyIHI9bmV3IHRoaXMuY29uc3RydWN0b3IodCk7cmV0dXJuIG4odGhpcyxuZXcgbChlLGkscikpLHJ9LHIuYWxsPWZ1bmN0aW9uKGUpe3ZhciB0PUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGUpO3JldHVybiBuZXcgcihmdW5jdGlvbihlLGkpe2Z1bmN0aW9uIHIobyxzKXt0cnl7aWYocyYmKFwib2JqZWN0XCI9PT0oXCJ1bmRlZmluZWRcIj09dHlwZW9mIHM/XCJ1bmRlZmluZWRcIjpfdHlwZW9mKHMpKXx8XCJmdW5jdGlvblwiPT10eXBlb2Ygcykpe3ZhciBhPXMudGhlbjtpZihcImZ1bmN0aW9uXCI9PXR5cGVvZiBhKXJldHVybiB2b2lkIGEuY2FsbChzLGZ1bmN0aW9uKGUpe3IobyxlKX0saSl9dFtvXT1zLDA9PT0tLW4mJmUodCl9Y2F0Y2gobCl7aShsKX19aWYoMD09PXQubGVuZ3RoKXJldHVybiBlKFtdKTtmb3IodmFyIG49dC5sZW5ndGgsbz0wO288dC5sZW5ndGg7bysrKXIobyx0W29dKX0pfSxyLnJlc29sdmU9ZnVuY3Rpb24oZSl7cmV0dXJuIGUmJlwib2JqZWN0XCI9PT0oXCJ1bmRlZmluZWRcIj09dHlwZW9mIGU/XCJ1bmRlZmluZWRcIjpfdHlwZW9mKGUpKSYmZS5jb25zdHJ1Y3Rvcj09PXI/ZTpuZXcgcihmdW5jdGlvbih0KXt0KGUpfSl9LHIucmVqZWN0PWZ1bmN0aW9uKGUpe3JldHVybiBuZXcgcihmdW5jdGlvbih0LGkpe2koZSl9KX0sci5yYWNlPWZ1bmN0aW9uKGUpe3JldHVybiBuZXcgcihmdW5jdGlvbih0LGkpe2Zvcih2YXIgcj0wLG49ZS5sZW5ndGg7cjxuO3IrKyllW3JdLnRoZW4odCxpKX0pfSxyLl9pbW1lZGlhdGVGbj1cImZ1bmN0aW9uXCI9PXR5cGVvZiBzZXRJbW1lZGlhdGUmJmZ1bmN0aW9uKGUpe3NldEltbWVkaWF0ZShlKX18fGZ1bmN0aW9uKGUpe2QoZSwwKX0sci5fdW5oYW5kbGVkUmVqZWN0aW9uRm49ZnVuY3Rpb24oZSl7XCJ1bmRlZmluZWRcIiE9dHlwZW9mIGNvbnNvbGUmJmNvbnNvbGUmJmNvbnNvbGUud2FybihcIlBvc3NpYmxlIFVuaGFuZGxlZCBQcm9taXNlIFJlamVjdGlvbjpcIixlKX0sci5fc2V0SW1tZWRpYXRlRm49ZnVuY3Rpb24oZSl7ci5faW1tZWRpYXRlRm49ZX0sci5fc2V0VW5oYW5kbGVkUmVqZWN0aW9uRm49ZnVuY3Rpb24oZSl7ci5fdW5oYW5kbGVkUmVqZWN0aW9uRm49ZX0sXCJ1bmRlZmluZWRcIiE9dHlwZW9mIG1vZHVsZSYmbW9kdWxlLmV4cG9ydHM/bW9kdWxlLmV4cG9ydHM9cjplLlByb21pc2V8fChlLlByb21pc2U9cil9KHdpbmRvdyksZnVuY3Rpb24oZSl7ZS5Qcm9taXNlfHwoZS5Qcm9taXNlPVByb21pc2UpO3ZhciB0PVwicmVxdWlyZWRcIixpPVwiZW1haWxcIixyPVwibWluTGVuZ3RoXCIsbj1cIm1heExlbmd0aFwiLG89XCJwYXNzd29yZFwiLHM9XCJ6aXBcIixhPVwicGhvbmVcIixsPVwicmVtb3RlXCIsdT1cInN0cmVuZ3RoXCIsZD1cImZ1bmN0aW9uXCIsYz1mdW5jdGlvbihlLHQpe2lmKFwic3RyaW5nXCI9PXR5cGVvZiBlKXJldHVybiBlO3ZhciBpPVwicG9zdFwiPT09dC50b0xvd2VyQ2FzZSgpP1wiXCI6XCI/XCI7cmV0dXJuIEFycmF5LmlzQXJyYXkoZSk/aStlLm1hcChmdW5jdGlvbihlKXtyZXR1cm4gZS5uYW1lK1wiPVwiK2UudmFsdWV9KS5qb2luKFwiJlwiKTppK09iamVjdC5rZXlzKGUpLm1hcChmdW5jdGlvbih0KXtyZXR1cm4gdCtcIj1cIitlW3RdfSkuam9pbihcIiZcIil9LGg9ZnVuY3Rpb24oZSl7dmFyIHQ9ZS51cmwsaT1lLm1ldGhvZCxyPWUuZGF0YSxuPWUuZGVidWcsbz1lLmNhbGxiYWNrLHM9ZS5lcnJvcjtpZihuKXJldHVybiB2b2lkIG8oXCJ0ZXN0XCIpO3ZhciBhPWUuYXN5bmMhPT0hMSxsPW5ldyBYTUxIdHRwUmVxdWVzdCx1PWMocixcImdldFwiKSxkPW51bGw7XCJwb3N0XCI9PT1pLnRvTG93ZXJDYXNlKCkmJihkPWMocixcInBvc3RcIiksdT1cIlwiKSxsLm9wZW4oaSx0K3UsYSksbC5zZXRSZXF1ZXN0SGVhZGVyKFwiQ29udGVudC1UeXBlXCIsXCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWRcIiksbC5vbnJlYWR5c3RhdGVjaGFuZ2U9ZnVuY3Rpb24oKXs0PT09dGhpcy5yZWFkeVN0YXRlJiYoMjAwPT09dGhpcy5zdGF0dXM/byh0aGlzLnJlc3BvbnNlVGV4dCk6cyYmcyh0aGlzLnJlc3BvbnNlVGV4dCkpfSxsLnNlbmQoZCl9LGY9ZnVuY3Rpb24oZSx0KXt0aGlzLm9wdGlvbnM9dHx8e30sdGhpcy5ydWxlcz10aGlzLm9wdGlvbnMucnVsZXN8fHt9LHRoaXMubWVzc2FnZXM9dGhpcy5vcHRpb25zLm1lc3NhZ2VzfHx2b2lkIDAsdGhpcy5jb2xvcldyb25nPXRoaXMub3B0aW9ucy5jb2xvcldyb25nfHxcIiNCODExMTFcIix0aGlzLnJlc3VsdD17fSx0aGlzLmVsZW1lbnRzPVtdLHRoaXMudG9vbHRpcD10aGlzLm9wdGlvbnMudG9vbHRpcHx8e30sdGhpcy50b29sdGlwRmFkZU91dFRpbWU9dGhpcy50b29sdGlwLmZhZGVPdXRUaW1lfHw1ZTMsdGhpcy50b29sdGlwRmFkZU91dENsYXNzPXRoaXMudG9vbHRpcC5mYWRlT3V0Q2xhc3N8fFwianVzdC12YWxpZGF0ZS10b29sdGlwLWhpZGVcIix0aGlzLnRvb2x0aXBTZWxlY3RvcldyYXA9ZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCh0aGlzLnRvb2x0aXAuc2VsZWN0b3JXcmFwKS5sZW5ndGg/ZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCh0aGlzLnRvb2x0aXAuc2VsZWN0b3JXcmFwKTpkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmp1c3QtdmFsaWRhdGUtdG9vbHRpcC1jb250YWluZXJcIiksdGhpcy5iaW5kSGFuZGxlcktleXVwPXRoaXMuaGFuZGxlcktleXVwLmJpbmQodGhpcyksdGhpcy5zdWJtaXRIYW5kbGVyPXRoaXMub3B0aW9ucy5zdWJtaXRIYW5kbGVyfHx2b2lkIDAsdGhpcy5pbnZhbGlkRm9ybUNhbGxiYWNrPXRoaXMub3B0aW9ucy5pbnZhbGlkRm9ybUNhbGxiYWNrfHx2b2lkIDAsdGhpcy5wcm9taXNlc1JlbW90ZT1bXSx0aGlzLmlzVmFsaWRhdGlvblN1Y2Nlc3M9ITEsdGhpcy5mb2N1c1dyb25nRmllbGQ9dGhpcy5vcHRpb25zLmZvY3VzV3JvbmdGaWVsZHx8ITEsdGhpcy5SRUdFWFA9e2VtYWlsOi9eKChbXjw+KClcXFtcXF1cXFxcLiw7Olxcc0BcIl0rKFxcLltePD4oKVxcW1xcXVxcXFwuLDs6XFxzQFwiXSspKil8KFwiLitcIikpQCgoXFxbWzAtOV17MSwzfVxcLlswLTldezEsM31cXC5bMC05XXsxLDN9XFwuWzAtOV17MSwzfV0pfCgoW2EtekEtWlxcLTAtOV0rXFwuKStbYS16QS1aXXsyLH0pKSQvLHppcDovXlxcZHs1fSgtXFxkezR9KT8kLyxwaG9uZTovXihbMC05XSggfC0pPyk/KFxcKD9bMC05XXszfVxcKT98WzAtOV17M30pKCB8LSk/KFswLTldezN9KCB8LSk/WzAtOV17NH18W2EtekEtWjAtOV17N30pJC8scGFzc3dvcmQ6L1teXFx3XFxkXSooKFswLTldKy4qW0EtWmEtel0rLiopfFtBLVphLXpdKy4qKFswLTldKy4qKSkvLHN0cmVuZ3RoUGFzczovXig/PS4qW2Etel0pKD89LipbQS1aXSkoPz0uKlxcZClbYS16QS1aXFxkXS99LHRoaXMuREVGQVVMVF9SRU1PVEVfRVJST1I9XCJFcnJvclwiLHRoaXMuc3RhdGU9e3Rvb2x0aXBzVGltZXI6bnVsbH0sdGhpcy5zZXRGb3JtKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZSkpfTtmLnByb3RvdHlwZT17ZGVmYXVsdFJ1bGVzOntlbWFpbDp7cmVxdWlyZWQ6ITAsZW1haWw6ITB9LG5hbWU6e3JlcXVpcmVkOiEwLG1pbkxlbmd0aDozLG1heExlbmd0aDoxNX0sdGV4dDp7cmVxdWlyZWQ6ITAsbWF4TGVuZ3RoOjMwMCxtaW5MZW5ndGg6NX0scGFzc3dvcmQ6e3JlcXVpcmVkOiEwLHBhc3N3b3JkOiEwLG1pbkxlbmd0aDo0LG1heExlbmd0aDo4fSx6aXA6e3JlcXVpcmVkOiEwLHppcDohMH0scGhvbmU6e3Bob25lOiEwfX0sZGVmYXVsdE1lc3NhZ2VzOntyZXF1aXJlZDpcIlRoZSBmaWVsZCBpcyByZXF1aXJlZFwiLGVtYWlsOlwiUGxlYXNlLCB0eXBlIGEgdmFsaWQgZW1haWxcIixtYXhMZW5ndGg6XCJUaGUgZmllbGQgbXVzdCBjb250YWluIGEgbWF4aW11bSBvZiA6dmFsdWUgY2hhcmFjdGVyc1wiLG1pbkxlbmd0aDpcIlRoZSBmaWVsZCBtdXN0IGNvbnRhaW4gYSBtaW5pbXVtIG9mIDp2YWx1ZSBjaGFyYWN0ZXJzXCIscGFzc3dvcmQ6XCJQYXNzd29yZCBpcyBub3QgdmFsaWRcIixyZW1vdGU6XCJFbWFpbCBhbHJlYWR5IGV4aXN0c1wiLHN0cmVuZ3RoOlwiUGFzc3dvcmQgbXVzdCBjb250ZW50cyBhdCBsZWFzdCBvbmUgdXBwZXJjYXNlIGxldHRlciwgb25lIGxvd2VyY2FzZSBsZXR0ZXIgYW5kIG9uZSBudW1iZXJcIixcImZ1bmN0aW9uXCI6XCJGdW5jdGlvbiByZXR1cm5lZCBmYWxzZVwifSxoYW5kbGVyS2V5dXA6ZnVuY3Rpb24oZSl7dmFyIHQ9ZS50YXJnZXQsaT17bmFtZTp0LmdldEF0dHJpYnV0ZShcImRhdGEtdmFsaWRhdGUtZmllbGRcIiksdmFsdWU6dC52YWx1ZX07ZGVsZXRlIHRoaXMucmVzdWx0W2kubmFtZV0sdGhpcy52YWxpZGF0ZUl0ZW0oe25hbWU6aS5uYW1lLHZhbHVlOmkudmFsdWUsZ3JvdXA6W10saXNLZXl1cENoYW5nZTohMH0pLHRoaXMucmVuZGVyRXJyb3JzKCl9LHNldHRlckV2ZW50TGlzdGVuZXI6ZnVuY3Rpb24oZSx0LGkscil7c3dpdGNoKFwia2V5dXBcIj09PXQmJihpPXRoaXMuYmluZEhhbmRsZXJLZXl1cCkscil7Y2FzZVwiYWRkXCI6ZS5hZGRFdmVudExpc3RlbmVyKHQsaSk7YnJlYWs7Y2FzZVwicmVtb3ZlXCI6ZS5yZW1vdmVFdmVudExpc3RlbmVyKHQsaSl9fSxnZXRFbGVtZW50c1JlYWxWYWx1ZTpmdW5jdGlvbigpe2Zvcih2YXIgZT10aGlzLiRmb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoXCIqXCIpLHQ9dm9pZCAwLGk9e30scj0wLG49ZS5sZW5ndGg7cjxuOysrcilpZih0PWVbcl0uZ2V0QXR0cmlidXRlKFwibmFtZVwiKSl7aWYoXCJjaGVja2JveFwiPT09ZVtyXS50eXBlKXtpW3RdPWVbcl0uY2hlY2tlZDtjb250aW51ZX1pW3RdPWVbcl0udmFsdWV9cmV0dXJuIGl9LHZhbGlkYXRpb25GYWlsZWQ6ZnVuY3Rpb24oKXt0aGlzLmludmFsaWRGb3JtQ2FsbGJhY2smJnRoaXMuaW52YWxpZEZvcm1DYWxsYmFjayh0aGlzLnJlc3VsdCk7dmFyIGU9ZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5qcy12YWxpZGF0ZS1lcnJvci1maWVsZFwiKTt0aGlzLmZvY3VzV3JvbmdGaWVsZCYmZSYmZS5mb2N1cyYmZS5mb2N1cygpfSx2YWxpZGF0aW9uU3VjY2VzczpmdW5jdGlvbigpe2lmKDA9PT1PYmplY3Qua2V5cyh0aGlzLnJlc3VsdCkubGVuZ3RoKXtpZih0aGlzLmlzVmFsaWRhdGlvblN1Y2Nlc3M9ITEsdGhpcy5zdWJtaXRIYW5kbGVyKXt2YXIgZT10aGlzLmdldEVsZW1lbnRzUmVhbFZhbHVlKCk7cmV0dXJuIHZvaWQgdGhpcy5zdWJtaXRIYW5kbGVyKHRoaXMuJGZvcm0sZSxoKX10aGlzLiRmb3JtLnN1Ym1pdCgpfX0sc2V0Rm9ybTpmdW5jdGlvbihlKXt2YXIgdD10aGlzO3RoaXMuJGZvcm09ZSx0aGlzLiRmb3JtLnNldEF0dHJpYnV0ZShcIm5vdmFsaWRhdGVcIixcIm5vdmFsaWRhdGVcIiksdGhpcy4kZm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsZnVuY3Rpb24oZSl7cmV0dXJuIGUucHJldmVudERlZmF1bHQoKSx0LnJlc3VsdD1bXSx0LmdldEVsZW1lbnRzKCksdC5wcm9taXNlc1JlbW90ZS5sZW5ndGg/dm9pZCBQcm9taXNlLmFsbCh0LnByb21pc2VzUmVtb3RlKS50aGVuKGZ1bmN0aW9uKCl7dC5wcm9taXNlc1JlbW90ZT1bXSx0LmlzVmFsaWRhdGlvblN1Y2Nlc3M/dC52YWxpZGF0aW9uU3VjY2VzcygpOnQudmFsaWRhdGlvbkZhaWxlZCgpfSk6dm9pZCh0LmlzVmFsaWRhdGlvblN1Y2Nlc3M/dC52YWxpZGF0aW9uU3VjY2VzcygpOnQudmFsaWRhdGlvbkZhaWxlZCgpKX0pfSxpc0VtYWlsOmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLlJFR0VYUC5lbWFpbC50ZXN0KGUpfSxpc1ppcDpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5SRUdFWFAuemlwLnRlc3QoZSl9LGlzUGhvbmU6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuUkVHRVhQLnBob25lLnRlc3QoZSl9LGlzUGFzc3dvcmQ6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuUkVHRVhQLnBhc3N3b3JkLnRlc3QoZSl9LGlzRW1wdHk6ZnVuY3Rpb24oZSl7dmFyIHQ9ZTtyZXR1cm4gZS50cmltJiYodD1lLnRyaW0oKSksIXR9LGNoZWNrTGVuZ3RoTWF4OmZ1bmN0aW9uKGUsdCl7cmV0dXJuIGUubGVuZ3RoPD10fSxjaGVja0xlbmd0aE1pbjpmdW5jdGlvbihlLHQpe3JldHVybiBlLmxlbmd0aD49dH0sY2hlY2tTdHJlbmd0aFBhc3M6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuUkVHRVhQLnN0cmVuZ3RoUGFzcy50ZXN0KGUpfSxnZXRFbGVtZW50czpmdW5jdGlvbigpe3ZhciBlPXRoaXMsdD10aGlzLiRmb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoXCJbZGF0YS12YWxpZGF0ZS1maWVsZF1cIik7dGhpcy5lbGVtZW50cz1bXTtmb3IodmFyIGk9ZnVuY3Rpb24oaSxyKXt2YXIgbj10W2ldLG89bi5nZXRBdHRyaWJ1dGUoXCJkYXRhLXZhbGlkYXRlLWZpZWxkXCIpLHM9bi52YWx1ZSxhPSExLGw9W107aWYoXCJjaGVja2JveFwiPT09bi50eXBlJiYocz1uLmNoZWNrZWR8fFwiXCIsbi5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsZnVuY3Rpb24odCl7dmFyIGk9dC50YXJnZXQscj17bmFtZTppLmdldEF0dHJpYnV0ZShcImRhdGEtdmFsaWRhdGUtZmllbGRcIiksdmFsdWU6aS5jaGVja2VkfTtkZWxldGUgZS5yZXN1bHRbci5uYW1lXSxlLnZhbGlkYXRlSXRlbSh7bmFtZTpyLm5hbWUsdmFsdWU6ci52YWx1ZSxncm91cDpbXX0pLGUucmVuZGVyRXJyb3JzKCl9KSksXCJyYWRpb1wiPT09bi50eXBlKXt2YXIgdT1lLmVsZW1lbnRzLmZpbHRlcihmdW5jdGlvbihlKXtpZihlLm5hbWU9PT1vKXJldHVybiBlfSlbMF07dT8odS5ncm91cC5wdXNoKG4uY2hlY2tlZCksYT0hMCk6bC5wdXNoKG4uY2hlY2tlZCksbi5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsZnVuY3Rpb24odCl7dmFyIGk9dC50YXJnZXQscj17bmFtZTppLmdldEF0dHJpYnV0ZShcImRhdGEtdmFsaWRhdGUtZmllbGRcIiksdmFsdWU6aS5jaGVja2VkfTtkZWxldGUgZS5yZXN1bHRbci5uYW1lXSxlLnZhbGlkYXRlSXRlbSh7bmFtZTpyLm5hbWUsdmFsdWU6ci52YWx1ZSxncm91cDpbXX0pLGUucmVuZGVyRXJyb3JzKCl9KX1lLnNldHRlckV2ZW50TGlzdGVuZXIobixcImtleXVwXCIsZS5oYW5kbGVyS2V5dXAsXCJhZGRcIiksYXx8ZS5lbGVtZW50cy5wdXNoKHtuYW1lOm8sdmFsdWU6cyxncm91cDpsfSl9LHI9MCxuPXQubGVuZ3RoO3I8bjsrK3IpaShyLG4pO3RoaXMudmFsaWRhdGVFbGVtZW50cygpfSx2YWxpZGF0ZVJlcXVpcmVkOmZ1bmN0aW9uKGUpe3JldHVybiF0aGlzLmlzRW1wdHkoZSl9LHZhbGlkYXRlRW1haWw6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuaXNFbWFpbChlKX0sdmFsaWRhdGVQaG9uZTpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5pc1Bob25lKGUpfSx2YWxpZGF0ZU1pbkxlbmd0aDpmdW5jdGlvbihlLHQpe3JldHVybiB0aGlzLmNoZWNrTGVuZ3RoTWluKGUsdCl9LHZhbGlkYXRlTWF4TGVuZ3RoOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIHRoaXMuY2hlY2tMZW5ndGhNYXgoZSx0KX0sdmFsaWRhdGVTdHJlbmd0aFBhc3M6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuY2hlY2tTdHJlbmd0aFBhc3MoZSl9LHZhbGlkYXRlUGFzc3dvcmQ6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuaXNQYXNzd29yZChlKX0sdmFsaWRhdGVaaXA6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuaXNaaXAoZSl9LHZhbGlkYXRlUmVtb3RlOmZ1bmN0aW9uKGUpe3ZhciB0PWUudmFsdWUsaT1lLm5hbWUscj1lLnVybCxuPWUuc3VjY2Vzc0Fuc3dlcixvPWUuc2VuZFBhcmFtLHM9ZS5tZXRob2Q7cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKGUpe2goe3VybDpyLG1ldGhvZDpzLGRhdGE6X2RlZmluZVByb3BlcnR5KHt9LG8sdCksYXN5bmM6ITAsY2FsbGJhY2s6ZnVuY3Rpb24odCl7dC50b0xvd2VyQ2FzZSgpPT09bi50b0xvd2VyQ2FzZSgpJiZlKFwib2tcIiksZSh7dHlwZTpcImluY29ycmVjdFwiLG5hbWU6aX0pfSxlcnJvcjpmdW5jdGlvbigpe2Uoe3R5cGU6XCJlcnJvclwiLG5hbWU6aX0pfX0pfSl9LGdlbmVyYXRlTWVzc2FnZTpmdW5jdGlvbihlLHQsaSl7dmFyIHI9dGhpcy5tZXNzYWdlc3x8dGhpcy5kZWZhdWx0TWVzc2FnZXMsbj1yW3RdJiZyW3RdW2VdfHx0aGlzLm1lc3NhZ2VzJiZcInN0cmluZ1wiPT10eXBlb2YgdGhpcy5tZXNzYWdlc1t0XSYmclt0XXx8dGhpcy5kZWZhdWx0TWVzc2FnZXNbZV18fHRoaXMuREVGQVVMVF9SRU1PVEVfRVJST1I7aSYmKG49bi5yZXBsYWNlKFwiOnZhbHVlXCIsaS50b1N0cmluZygpKSksdGhpcy5yZXN1bHRbdF09e21lc3NhZ2U6bn19LHZhbGlkYXRlRWxlbWVudHM6ZnVuY3Rpb24oKXt2YXIgZT10aGlzO3JldHVybiB0aGlzLmxvY2tGb3JtKCksdGhpcy5lbGVtZW50cy5mb3JFYWNoKGZ1bmN0aW9uKHQpe2UudmFsaWRhdGVJdGVtKHtuYW1lOnQubmFtZSx2YWx1ZTp0LnZhbHVlLGdyb3VwOnQuZ3JvdXB9KX0pLHRoaXMucHJvbWlzZXNSZW1vdGUubGVuZ3RoP3ZvaWQgUHJvbWlzZS5hbGwodGhpcy5wcm9taXNlc1JlbW90ZSkudGhlbihmdW5jdGlvbih0KXt0LmZvckVhY2goZnVuY3Rpb24odCl7cmV0dXJuXCJva1wiPT09dD92b2lkIGUucmVuZGVyRXJyb3JzKCk6KFwiZXJyb3JcIj09PXQudHlwZSYmYWxlcnQoXCJTZXJ2ZXIgZXJyb3Igb2NjdXJlZC4gUGxlYXNlIHRyeSBsYXRlci5cIiksZS5nZW5lcmF0ZU1lc3NhZ2UobCx0Lm5hbWUpLHZvaWQgZS5yZW5kZXJFcnJvcnMoKSl9KX0pOnZvaWQgdGhpcy5yZW5kZXJFcnJvcnMoKX0sdmFsaWRhdGVJdGVtOmZ1bmN0aW9uKGUpe3ZhciBjPXRoaXMsaD1lLm5hbWUsZj1lLmdyb3VwLG09ZS52YWx1ZSx2PWUuaXNLZXl1cENoYW5nZSxwPXRoaXMucnVsZXNbaF18fHRoaXMuZGVmYXVsdFJ1bGVzW2hdfHwhMTtpZihwKWZvcih2YXIgZyBpbiBwKXt2YXIgeT1wW2ddO2lmKGchPT10JiZnIT09ZCYmXCJcIj09bSlyZXR1cm47c3dpdGNoKGcpe2Nhc2UgZDppZihcImZ1bmN0aW9uXCIhPXR5cGVvZiB5KWJyZWFrO2lmKHkoaCxtKSlicmVhaztyZXR1cm4gdm9pZCB0aGlzLmdlbmVyYXRlTWVzc2FnZShkLGgseSk7Y2FzZSB0OmlmKCF5KWJyZWFrO2lmKGYubGVuZ3RoKXt2YXIgYj0hMTtpZihmLmZvckVhY2goZnVuY3Rpb24oZSl7Yy52YWxpZGF0ZVJlcXVpcmVkKGUpJiYoYj0hMCl9KSxiKWJyZWFrfWVsc2UgaWYodGhpcy52YWxpZGF0ZVJlcXVpcmVkKG0pKWJyZWFrO3JldHVybiB2b2lkIHRoaXMuZ2VuZXJhdGVNZXNzYWdlKHQsaCk7Y2FzZSBpOmlmKCF5KWJyZWFrO2lmKHRoaXMudmFsaWRhdGVFbWFpbChtKSlicmVhaztyZXR1cm4gdm9pZCB0aGlzLmdlbmVyYXRlTWVzc2FnZShpLGgpO2Nhc2UgcjppZigheSlicmVhaztpZih0aGlzLnZhbGlkYXRlTWluTGVuZ3RoKG0seSkpYnJlYWs7cmV0dXJuIHZvaWQgdGhpcy5nZW5lcmF0ZU1lc3NhZ2UocixoLHkpO2Nhc2UgbjppZigheSlicmVhaztpZih0aGlzLnZhbGlkYXRlTWF4TGVuZ3RoKG0seSkpYnJlYWs7cmV0dXJuIHZvaWQgdGhpcy5nZW5lcmF0ZU1lc3NhZ2UobixoLHkpO2Nhc2UgYTppZigheSlicmVhaztpZih0aGlzLnZhbGlkYXRlUGhvbmUobSkpYnJlYWs7cmV0dXJuIHZvaWQgdGhpcy5nZW5lcmF0ZU1lc3NhZ2UoYSxoKTtjYXNlIG86aWYoIXkpYnJlYWs7aWYodGhpcy52YWxpZGF0ZVBhc3N3b3JkKG0pKWJyZWFrO3JldHVybiB2b2lkIHRoaXMuZ2VuZXJhdGVNZXNzYWdlKG8saCk7Y2FzZSB1OmlmKCF5fHxcIm9iamVjdFwiIT09KFwidW5kZWZpbmVkXCI9PXR5cGVvZiB5P1widW5kZWZpbmVkXCI6X3R5cGVvZih5KSkpYnJlYWs7aWYoeVtcImRlZmF1bHRcIl0mJnRoaXMudmFsaWRhdGVTdHJlbmd0aFBhc3MobSkpYnJlYWs7aWYoeS5jdXN0b20pe3ZhciBFPXZvaWQgMDt0cnl7RT1uZXcgUmVnRXhwKHkuY3VzdG9tKX1jYXRjaCh3KXtFPXRoaXMuUkVHRVhQLnN0cmVuZ3RoUGFzcyxjb25zb2xlLmVycm9yKFwiQ3VzdG9tIHJlZ2V4cCBmb3Igc3RyZW5ndGggcnVsZSBpcyBub3QgdmFsaWQuIERlZmF1bHQgcmVnZXhwIHdhcyB1c2VkLlwiKX1pZihFLnRlc3QobSkpYnJlYWt9cmV0dXJuIHZvaWQgdGhpcy5nZW5lcmF0ZU1lc3NhZ2UodSxoKTtjYXNlIHM6aWYoIXkpYnJlYWs7aWYodGhpcy52YWxpZGF0ZVppcChtKSlicmVhaztyZXR1cm4gdm9pZCB0aGlzLmdlbmVyYXRlTWVzc2FnZShzLGgpO2Nhc2UgbDppZih2KWJyZWFrO2lmKCF5KWJyZWFrO3ZhciBrPXkudXJsLF89eS5zdWNjZXNzQW5zd2VyLFA9eS5tZXRob2QsUj15LnNlbmRQYXJhbSxTPXRoaXMuJGZvcm0ucXVlcnlTZWxlY3RvcignaW5wdXRbZGF0YS12YWxpZGF0ZS1maWVsZD1cIicraCsnXCJdJyk7cmV0dXJuIHRoaXMuc2V0dGVyRXZlbnRMaXN0ZW5lcihTLFwia2V5dXBcIix0aGlzLmhhbmRsZXJLZXl1cCxcInJlbW92ZVwiKSx2b2lkIHRoaXMucHJvbWlzZXNSZW1vdGUucHVzaCh0aGlzLnZhbGlkYXRlUmVtb3RlKHtuYW1lOmgsdmFsdWU6bSx1cmw6ayxtZXRob2Q6UCxzZW5kUGFyYW06UixzdWNjZXNzQW5zd2VyOl99KSl9fX0sY2xlYXJFcnJvcnM6ZnVuY3Rpb24oKXtmb3IodmFyIGU9ZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5qcy12YWxpZGF0ZS1lcnJvci1sYWJlbFwiKSx0PTAsaT1lLmxlbmd0aDt0PGk7Kyt0KWVbdF0ucmVtb3ZlKCk7ZT1kb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmpzLXZhbGlkYXRlLWVycm9yLWZpZWxkXCIpO2Zvcih2YXIgcj0wLG49ZS5sZW5ndGg7cjxuOysrcillW3JdLmNsYXNzTGlzdC5yZW1vdmUoXCJqcy12YWxpZGF0ZS1lcnJvci1maWVsZFwiKSxlW3JdLnN0eWxlLmJvcmRlcj1cIlwiLGVbcl0uc3R5bGUuY29sb3I9XCJcIn0scmVuZGVyRXJyb3JzOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcztpZih0aGlzLmNsZWFyRXJyb3JzKCksdGhpcy51bmxvY2tGb3JtKCksdGhpcy5pc1ZhbGlkYXRpb25TdWNjZXNzPSExLDA9PT1PYmplY3Qua2V5cyh0aGlzLnJlc3VsdCkubGVuZ3RoKXJldHVybiB2b2lkKHRoaXMuaXNWYWxpZGF0aW9uU3VjY2Vzcz0hMCk7Zm9yKHZhciB0IGluIHRoaXMucmVzdWx0KXt2YXIgaT10aGlzLnJlc3VsdFt0XS5tZXNzYWdlLHI9dGhpcy4kZm9ybS5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS12YWxpZGF0ZS1maWVsZD1cIicrdCsnXCJdJyksbj1yW3IubGVuZ3RoLTFdLG89ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtpZihvLmlubmVySFRNTD1pLG8uY2xhc3NOYW1lPVwianMtdmFsaWRhdGUtZXJyb3ItbGFiZWxcIixvLnNldEF0dHJpYnV0ZShcInN0eWxlXCIsXCJjb2xvcjogXCIrdGhpcy5jb2xvcldyb25nKSxuLnN0eWxlLmJvcmRlcj1cIjFweCBzb2xpZCBcIit0aGlzLmNvbG9yV3Jvbmcsbi5zdHlsZS5jb2xvcj1cIlwiK3RoaXMuY29sb3JXcm9uZyxuLmNsYXNzTGlzdC5hZGQoXCJqcy12YWxpZGF0ZS1lcnJvci1maWVsZFwiKSxcImNoZWNrYm94XCI9PT1uLnR5cGV8fFwicmFkaW9cIj09PW4udHlwZSl7dmFyIHM9ZG9jdW1lbnQucXVlcnlTZWxlY3RvcignbGFiZWxbZm9yPVwiJytuLmdldEF0dHJpYnV0ZShcImlkXCIpKydcIl0nKTtcImxhYmVsXCI9PT1uLnBhcmVudE5vZGUudGFnTmFtZS50b0xvd2VyQ2FzZSgpP24ucGFyZW50Tm9kZS5wYXJlbnROb2RlLmluc2VydEJlZm9yZShvLG51bGwpOnM/cy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShvLHMubmV4dFNpYmxpbmcpOm4ucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUobyxuLm5leHRTaWJsaW5nKX1lbHNlIG4ucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUobyxuLm5leHRTaWJsaW5nKX10aGlzLnRvb2x0aXBTZWxlY3RvcldyYXAubGVuZ3RoJiYodGhpcy5zdGF0ZS50b29sdGlwc1RpbWVyPXNldFRpbWVvdXQoZnVuY3Rpb24oKXtlLmhpZGVUb29sdGlwcygpfSx0aGlzLnRvb2x0aXBGYWRlT3V0VGltZSkpfSxoaWRlVG9vbHRpcHM6ZnVuY3Rpb24oKXt2YXIgZT10aGlzLHQ9ZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5qcy12YWxpZGF0ZS1lcnJvci1sYWJlbFwiKTt0LmZvckVhY2goZnVuY3Rpb24odCl7dC5jbGFzc0xpc3QuYWRkKGUudG9vbHRpcEZhZGVPdXRDbGFzcyl9KSx0aGlzLnN0YXRlLnRvb2x0aXBzVGltZXI9bnVsbH0sbG9ja0Zvcm06ZnVuY3Rpb24oKXtmb3IodmFyIGU9dGhpcy4kZm9ybS5xdWVyeVNlbGVjdG9yQWxsKFwiaW5wdXQsIHRleHRhcmVhLCBidXR0b24sIHNlbGVjdFwiKSx0PTAsaT1lLmxlbmd0aDt0PGk7Kyt0KWVbdF0uc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIixcImRpc2FibGVkXCIpLGVbdF0uc3R5bGUucG9pbnRlckV2ZW50cz1cIm5vbmVcIixlW3RdLnN0eWxlLndlYml0RmlsdGVyPVwiZ3JheXNjYWxlKDEwMCUpXCIsZVt0XS5zdHlsZS5maWx0ZXI9XCJncmF5c2NhbGUoMTAwJSlcIn0sdW5sb2NrRm9ybTpmdW5jdGlvbigpe2Zvcih2YXIgZT10aGlzLiRmb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoXCJpbnB1dCwgdGV4dGFyZWEsIGJ1dHRvbiwgc2VsZWN0XCIpLHQ9MCxpPWUubGVuZ3RoO3Q8aTsrK3QpZVt0XS5yZW1vdmVBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiKSxlW3RdLnN0eWxlLnBvaW50ZXJFdmVudHM9XCJcIixlW3RdLnN0eWxlLndlYml0RmlsdGVyPVwiXCIsZVt0XS5zdHlsZS5maWx0ZXI9XCJcIn19LGUuSnVzdFZhbGlkYXRlPWZ9KHdpbmRvdyk7Il0sImZpbGUiOiJqdXN0LXZhbGlkYXRlLm1pbi5qcyJ9
